<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ordenamiento en la GPU | Learn Wgpu - Español</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css" as="style"><link rel="preload" href="/learn-wgpu-es/assets/js/app.fb31abca.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/2.1022e2be.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/1.4766453e.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/34.f2bc04d8.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/23.247ad87d.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/22.5d980ee9.js" as="script"><link rel="prefetch" href="/learn-wgpu-es/assets/js/10.85d1b333.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/11.3c198606.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/12.97c631a2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/13.8eb85f08.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/14.f56f5783.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/15.f146080a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/16.b78eff55.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/17.ac1b915c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/18.d64e2c10.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/19.b80b7231.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/20.5525796a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/21.d2868a6a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/24.086d80a7.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/25.0ba438e3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/26.aed3aec3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/27.b4a1c2ae.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/28.2764cb5c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/29.58f67d16.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/3.210ed7b2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/30.c5e766e5.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/31.5a6c1c03.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/32.b00abf9b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/33.c2bc481b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/35.58c2c8d8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/36.d4783bfb.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/37.0f259387.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/38.3c99ab64.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/39.84e651b2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/4.db40dd96.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/40.56d1e232.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/41.f90ff503.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/42.7911692d.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/43.4f83f7e5.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/44.943c009e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/45.0ab6ac73.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/46.c4185287.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/47.777cc2bf.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/48.96be8e13.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/49.aa04b1d6.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/5.6fdb9071.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/50.4022d2a0.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/51.3c411e45.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/52.2918a592.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/53.ee6c7c86.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/54.ec95ed52.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/55.da436f39.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/56.a7464507.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/57.38978bd1.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/58.f03403ea.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/59.d0f0d3af.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/60.675b3161.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/61.0d9a5510.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/62.cb765cf3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/8.c8ddf2a2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/9.28f40848.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/vendors~docsearch.ccaccf87.js">
    <link rel="stylesheet" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-es/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu - Español</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-es/" aria-current="page" class="sidebar-link">Introducción</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Principiante</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/beginner/tutorial1-window/" class="sidebar-link">Dependencias y la ventana</a></li><li><a href="/learn-wgpu-es/beginner/tutorial2-surface/" class="sidebar-link">La Superficie</a></li><li><a href="/learn-wgpu-es/beginner/tutorial3-pipeline/" class="sidebar-link">El Pipeline</a></li><li><a href="/learn-wgpu-es/beginner/tutorial4-buffer/" class="sidebar-link">Búferes e Índices</a></li><li><a href="/learn-wgpu-es/beginner/tutorial5-textures/" class="sidebar-link">Texturas y grupos de enlace</a></li><li><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/" class="sidebar-link">Búferes uniformes y una cámara 3D</a></li><li><a href="/learn-wgpu-es/beginner/tutorial7-instancing/" class="sidebar-link">Instanciación</a></li><li><a href="/learn-wgpu-es/beginner/tutorial8-depth/" class="sidebar-link">El Búfer de Profundidad</a></li><li><a href="/learn-wgpu-es/beginner/tutorial9-models/" class="sidebar-link">Carga de Modelos</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermedio</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/intermediate/tutorial10-lighting/" class="sidebar-link">Trabajando con Luces</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial11-normals/" class="sidebar-link">Mapeo de Normales</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial12-camera/" class="sidebar-link">Una Cámara Mejor</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial13-hdr/" class="sidebar-link">Renderizado de Alto Rango Dinámico</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Compute Pipelines</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/compute/introduction/" class="sidebar-link">Introducción a los Compute Pipelines</a></li><li><a href="/learn-wgpu-es/compute/sorting/" aria-current="page" class="active sidebar-link">Ordenamiento en la GPU</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#odd-even-sort-aka-brick-sort" class="sidebar-link">Odd-Even Sort (aka. Brick Sort)</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#¿cuando-dejamos-de-ordenar" class="sidebar-link">¿Cuándo dejamos de ordenar?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#portando-odd-even-sort-a-wgsl" class="sidebar-link">Portando odd-even sort a WGSL</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#condiciones-de-carrera-y-barreras" class="sidebar-link">Condiciones de carrera y barreras</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#llamando-al-sombreador" class="sidebar-link">Llamando al sombreador</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/compute/sorting/#conclusion" class="sidebar-link">Conclusión</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Showcase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Noticias</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ordenamiento-en-la-gpu"><a href="#ordenamiento-en-la-gpu" class="header-anchor">#</a> Ordenamiento en la GPU</h1> <p>Trabajar con datos ordenados hace que la mayoría de los algoritmos sean más fáciles de usar, por lo
que tiene sentido que queramos poder ordenar nuestros datos de GPU en
la GPU. Tenemos que repensar cómo abordamos el ordenamiento ya que la forma en que lo hacemos
no es la misma que con los algoritmos de ordenamiento tradicionales, que no están diseñados con
el poder de la computación paralela en mente. ¡Afortunadamente hay algunos algoritmos que sí
funcionan bien con la GPU!</p> <h2 id="odd-even-sort-aka-brick-sort"><a href="#odd-even-sort-aka-brick-sort" class="header-anchor">#</a> Odd-Even Sort (aka. Brick Sort)</h2> <p>Este ordenamiento funciona iterando sobre pares de elementos, comparándolos e
intercambiándolos si uno es mayor que el otro. Considera el siguiente
arreglo:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
</code></pre></div><p>Primero hacemos el pase impar. Esto significa que consideramos pares de elementos desde
el índice 1 (no 0) en adelante. Entonces para los datos anteriores, los pares serían los siguientes.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>Saltamos el primer y último término ya que no tienen otro número
junto a ellos que no esté ya emparejado. Luego intercambiamos el número mayor
con el número menor, lo que significa que nuestros datos se ven así:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre></div><p>Lo siguiente es el pase par. Es lo mismo que el pase impar, pero empezamos en el índice
0 en lugar de 1. Esto nos da los siguientes pares.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>Lo que al intercambiar nos da lo siguiente:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre></div><p>Este proceso se repite hasta que el arreglo esté ordenado. Aquí están los datos en cada
iteración después de esto:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// odd</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token comment">// even</span>
</code></pre></div><h2 id="¿cuando-dejamos-de-ordenar"><a href="#¿cuando-dejamos-de-ordenar" class="header-anchor">#</a> ¿Cuándo dejamos de ordenar?</h2> <p>La mayoría de los algoritmos de ordenamiento no verifican manualmente que el arreglo esté ordenado
después de cada iteración. Afortunadamente <a href="https://en.wikipedia.org/wiki/Odd%E2%80%93even_sort#cite_note-6" target="_blank" rel="noopener noreferrer">la investigación muestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
que el número máximo de iteraciones para completar este algoritmo es el
mismo que el número de elementos, es decir, N. Esto significa que dado un arreglo de
tamaño <code>N = 8</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><p>Tomará 8 pases ordenar estos datos.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// odd</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// even</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// odd</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// even</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// odd</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment">// even</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment">// odd</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token comment">// even</span>
</code></pre></div><p>Esto siempre funcionará, independientemente de los datos que estemos ordenando. Es un
poco ineficiente cuando tus datos están casi ordenados, así que querrás
tener eso en mente.</p> <h2 id="portando-odd-even-sort-a-wgsl"><a href="#portando-odd-even-sort-a-wgsl" class="header-anchor">#</a> Portando odd-even sort a WGSL</h2> <p>El odd-even sort es especial porque cada pase es trivial de paralelizar.
Cada par de elementos se considera independientemente de todos los otros elementos.
Eso significa que podemos dedicar un solo hilo a cada par que queramos
comparar. ¡Veamos el sombreador!</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">storage</span><span class="token punctuation">,</span> read_write<span class="token punctuation">&gt;</span> data<span class="token punctuation">:</span> <span class="token builtin">array</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">compute</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">64</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">odd_even_sort</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span>
    gid<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Esto funciona de manera muy similar al código de introducción. Configuramos nuestro bindgroup
con un <code>array&lt;u32&gt;</code> que es <code>read_write</code> ya que este ordenamiento funciona sin necesitar
un arreglo adicional para hacer la salida. También solo necesitamos el <code>global_invocation_id</code>
incorporado para indexar correctamente nuestro <code>data</code>. Ahora vamos a empezar a ver el código dentro
de <code>odd_even_sort</code>.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code>    <span class="token keyword">let</span> num_items <span class="token operator">=</span> <span class="token function-calls function">arrayLength</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> pair_index <span class="token operator">=</span> gid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
</code></pre></div><p>Primero obtenemos el índice del par en el que el hilo actual está trabajando.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code>    <span class="token comment">// odd</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> pair_index <span class="token operator">*</span> <span class="token int-literal number">2u</span> <span class="token operator">+</span> <span class="token int-literal number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token int-literal number">1u</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> a <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> b <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">&gt;</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> temp <span class="token operator">=</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Para esta parte del código, primero obtenemos los índices de los elementos que queremos comparar.
Si los índices están dentro de los límites y los valores están fuera de orden, intercambiamos los valores. También podemos
hacer el pase par para que podamos reducir a la mitad el número de veces que llamamos a este sombreador.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code>    <span class="token comment">// even</span>
    a <span class="token operator">=</span> pair_index <span class="token operator">*</span> <span class="token int-literal number">2u</span><span class="token punctuation">;</span>
    b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token int-literal number">1u</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> a <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> b <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">&gt;</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> temp <span class="token operator">=</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Parece que hemos terminado con el código del sombreador, pero técnicamente
hay un error en nuestro código. No tiene nada que ver con la lógica de nuestro código, tiene
que ver con la naturaleza de la programación paralela en general: condiciones de carrera.</p> <h2 id="condiciones-de-carrera-y-barreras"><a href="#condiciones-de-carrera-y-barreras" class="header-anchor">#</a> Condiciones de carrera y barreras</h2> <p><img src="/learn-wgpu-es/assets/img/race-condition-puppies.4a322f6e.jpg" alt="example of race conditions featuring puppies"></p> <p>Una condición de carrera ocurre cuando dos o más hilos intentan operar en la
misma ubicación en memoria. Si hiciéramos un paso para cada llamada al sombreador,
estaríamos bien, pero como hacemos dos pases, necesitamos asegurarnos de que
los hilos no se interfieran entre sí. Hacemos esto usando barreras.</p> <p>Una barrera hace que el hilo actual espere a que otros hilos terminen
antes de continuar. Hay dos tipos de barreras.</p> <p>Un <code>workgroupBarrier</code> hará que todos los hilos en el grupo de trabajo esperen
hasta que todos los otros hilos en el grupo de trabajo hayan llegado a la barrera. También
sincronizará todas las variables atómicas y los datos almacenados en el espacio de
dirección del grupo de trabajo.</p> <div class="note"><p>En WGSL, &quot;address space&quot; (espacio de dirección) determina cómo se puede acceder a un cierto trozo de datos.
Los datos en el espacio de dirección <code>workgroup</code> solo son accesibles por hilos dentro del
mismo grupo de trabajo. Muchos de los espacios de dirección son implícitos, como el
espacio de dirección <code>function</code>. Los espacios de dirección <code>uniform</code> y <code>storage</code> son
significativos ya que corresponden a búferes uniformes y búferes de almacenamiento
respectivamente.</p></div> <p>Un <code>storageBarrier</code> hará que la GPU sincronice todos los cambios en los búferes de almacenamiento.
Dado que nuestros datos están en un búfer de almacenamiento, esta es la barrera que necesitamos
para asegurar que todo se mantenga en sincronización. Agrega la siguiente línea entre los pases impar y
par.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code>    <span class="token builtin">storageBarrier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Con eso la función <code>odd_even_sort</code> se ve así:</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">compute</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">64</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">odd_even_sort</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span>
    gid<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> num_items <span class="token operator">=</span> <span class="token function-calls function">arrayLength</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> pair_index <span class="token operator">=</span> gid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>

    <span class="token comment">// odd</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> pair_index <span class="token operator">*</span> <span class="token int-literal number">2u</span> <span class="token operator">+</span> <span class="token int-literal number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token int-literal number">1u</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> a <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> b <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">&gt;</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> temp <span class="token operator">=</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token builtin">storageBarrier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// even</span>
    a <span class="token operator">=</span> pair_index <span class="token operator">*</span> <span class="token int-literal number">2u</span><span class="token punctuation">;</span>
    b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token int-literal number">1u</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> a <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> b <span class="token punctuation">&lt;</span> num_items <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">&gt;</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> temp <span class="token operator">=</span> data<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="llamando-al-sombreador"><a href="#llamando-al-sombreador" class="header-anchor">#</a> Llamando al sombreador</h2> <p>La mayoría del código es igual al código de introducción, con la
excepción de crear solo un búfer de almacenamiento y el siguiente
código para llamar al sombreador:</p> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token keyword">let</span> num_items_per_workgroup <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">// 64 threads, 2 items per thread</span>
    <span class="token keyword">let</span> num_dispatches <span class="token operator">=</span> <span class="token punctuation">(</span>input_data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> num_items_per_workgroup<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span>
        <span class="token operator">+</span> <span class="token punctuation">(</span>input_data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> num_items_per_workgroup <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
    <span class="token comment">// We do 2 passes in the shader so we only need to do half the passes</span>
    <span class="token keyword">let</span> num_passes <span class="token operator">=</span> input_data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_compute_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pass<span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>num_passes <span class="token punctuation">{</span>
            pass<span class="token punctuation">.</span><span class="token function">dispatch_workgroups</span><span class="token punctuation">(</span>num_dispatches<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Con esto, tus datos deberían estar ordenados. Ahora puedes usarlos para cualquier propósito
que necesites, como ordenar objetos transparentes por su coordenada z, u ordenar
objetos por la celda a la que pertenecen en una cuadrícula para detección y resolución de colisiones.
Usaremos ordenamiento para implementar algunos algoritmos diferentes en otras partes de
esta guía.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusión</h2> <p>El ordenamiento es uno de los pilares del desarrollo de software y ahora que podemos ordenar
nuestros datos de GPU sin enviarlos en un viaje de ida y vuelta a la GPU. Usaremos esto
mucho en el resto de esta guía.</p> <p>¡Gracias por leer esto, y un agradecimiento especial a estos patrocinadores!</p> <ul><li>Filip</li> <li>Lions Heart</li> <li>Jani Turkia</li> <li>Julius Liu</li> <li>折登 樹</li> <li>Aron Granberg</li> <li>Ian Gowen</li> <li>Bernard Llanos</li> <li>David Laban</li> <li>IC</li></ul> <div id="wasm-example"><!----> <!----> <!----> <!----> <!----></div> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/compute/src/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Última Actualización: </span> <span class="time">12/15/2025, 10:59:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-es/compute/introduction/" class="prev">
          Introducción a los Compute Pipelines
        </a></span> <span class="next"><a href="/learn-wgpu-es/showcase/">
          Prólogo
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-es/assets/js/app.fb31abca.js" defer></script><script src="/learn-wgpu-es/assets/js/2.1022e2be.js" defer></script><script src="/learn-wgpu-es/assets/js/1.4766453e.js" defer></script><script src="/learn-wgpu-es/assets/js/34.f2bc04d8.js" defer></script><script src="/learn-wgpu-es/assets/js/23.247ad87d.js" defer></script><script src="/learn-wgpu-es/assets/js/22.5d980ee9.js" defer></script>
  </body>
</html>
