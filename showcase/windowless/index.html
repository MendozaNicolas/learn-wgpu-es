<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Wgpu sin ventana | Learn Wgpu - Español</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css" as="style"><link rel="preload" href="/learn-wgpu-es/assets/js/app.1da4b688.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/3.adbf9188.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/2.cb1a7929.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/54.e3d2968f.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/38.875f4ce4.js" as="script"><link rel="prefetch" href="/learn-wgpu-es/assets/js/1.4f48abed.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/10.b7e8940b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/11.73867170.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/12.67d9bb8e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/13.7a96b491.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/14.5e178fd7.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/15.1fd30c11.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/16.e4f35d3f.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/17.d04aa74e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/18.74b1431f.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/19.5c3d7990.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/20.7656e214.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/21.49c8df61.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/22.2d036121.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/23.91a69f99.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/24.4534de06.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/25.40057d50.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/26.b3486d9a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/27.6b1e13e8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/28.14099108.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/29.0e81e00e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/30.7ee6c9a8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/31.b9e79cb5.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/32.7b0790d0.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/33.aa64fba8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/34.f338917c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/35.5a1ab6b4.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/36.bc32d842.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/37.38029664.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/39.ab729d62.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/4.2f7b6f81.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/40.6b168ce1.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/41.42966f50.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/42.a6f27c8d.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/43.bfae1c37.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/44.bca72294.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/45.f7af7c90.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/46.6bbbc12c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/47.ca03fcd2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/48.4dde588d.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/49.98f35d73.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/5.5433791e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/50.8ec43db8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/51.eaf78dc2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/52.43facef0.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/53.33405d68.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/55.b480d69c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/56.f736ebcf.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/57.77aa79cc.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/58.a093ef01.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/59.6a0d92d8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/6.c0282cbd.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/60.864b530f.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/61.b4bff856.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/62.31881615.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/63.2648fe69.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/64.3e547993.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/65.093678c1.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/66.67f025be.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/67.ac16597b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/68.dd166fda.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/69.2123c238.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/70.51ee8101.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/71.72a0df5f.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/72.fc944211.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/73.66464f66.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/74.dc0b78b1.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/75.d0b7ef79.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/76.db3c1665.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/77.c9896c4b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/9.6e2f5503.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/vendors~docsearch.0ad8ae62.js">
    <link rel="stylesheet" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-es/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu - Español</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-es/" aria-current="page" class="sidebar-link">Introducción</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Principiante</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/beginner/tutorial1-window/" class="sidebar-link">Dependencias y la ventana</a></li><li><a href="/learn-wgpu-es/beginner/tutorial2-surface/" class="sidebar-link">La Superficie</a></li><li><a href="/learn-wgpu-es/beginner/tutorial3-pipeline/" class="sidebar-link">El Pipeline</a></li><li><a href="/learn-wgpu-es/beginner/tutorial4-buffer/" class="sidebar-link">Búferes e Índices</a></li><li><a href="/learn-wgpu-es/beginner/tutorial5-textures/" class="sidebar-link">Texturas y grupos de enlace</a></li><li><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/" class="sidebar-link">Búferes uniformes y una cámara 3D</a></li><li><a href="/learn-wgpu-es/beginner/tutorial7-instancing/" class="sidebar-link">Instanciación</a></li><li><a href="/learn-wgpu-es/beginner/tutorial8-depth/" class="sidebar-link">El Búfer de Profundidad</a></li><li><a href="/learn-wgpu-es/beginner/tutorial9-models/" class="sidebar-link">Carga de Modelos</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermedio</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/intermediate/tutorial10-lighting/" class="sidebar-link">Trabajando con Luces</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial11-normals/" class="sidebar-link">Mapeo de Normales</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial12-camera/" class="sidebar-link">Una Cámara Mejor</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial13-hdr/" class="sidebar-link">Renderizado de Alto Rango Dinámico</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Compute Pipelines</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Showcase</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/showcase/" aria-current="page" class="sidebar-link">Prólogo</a></li><li><a href="/learn-wgpu-es/showcase/windowless/" aria-current="page" class="active sidebar-link">Wgpu sin ventana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-es/showcase/windowless/#entonces-¿que-necesitamos-hacer" class="sidebar-link">Entonces, ¿qué necesitamos hacer?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/showcase/windowless/#un-triangulo-sin-ventana" class="sidebar-link">Un triángulo sin ventana</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/showcase/windowless/#extrayendo-datos-de-un-bufer" class="sidebar-link">Extrayendo datos de un búfer</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/showcase/windowless/#main-no-es-asincronico" class="sidebar-link">Main no es asincrónico</a></li></ul></li><li><a href="/learn-wgpu-es/showcase/gifs/" class="sidebar-link">Creando GIFs</a></li><li><a href="/learn-wgpu-es/showcase/pong/" class="sidebar-link">Pong</a></li><li><a href="/learn-wgpu-es/showcase/compute/" class="sidebar-link">Ejemplo de Compute: Tangentes y Bitangentes</a></li><li><a href="/learn-wgpu-es/showcase/alignment/" class="sidebar-link">Diseño de Memoria en WGSL</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Noticias</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="wgpu-sin-ventana"><a href="#wgpu-sin-ventana" class="header-anchor">#</a> Wgpu sin ventana</h1> <p>A veces simplemente queremos aprovechar la gpu. Tal vez queramos procesar un gran conjunto de números en paralelo. Tal vez estamos trabajando en una película 3D y necesitamos crear una escena de apariencia realista con path tracing. Tal vez estamos minando una criptomoneda. En todas estas situaciones, no necesariamente <em>necesitamos</em> ver qué está sucediendo.</p> <h2 id="entonces-¿que-necesitamos-hacer"><a href="#entonces-¿que-necesitamos-hacer" class="header-anchor">#</a> Entonces, ¿qué necesitamos hacer?</h2> <p>Es realmente bastante simple. No <em>necesitamos</em> una ventana para crear una <code>Instance</code>, no <em>necesitamos</em> una ventana para seleccionar un <code>Adapter</code>, ni <em>necesitamos</em> una ventana para crear un <code>Device</code>. Solo necesitábamos la ventana para crear una <code>Surface</code> que necesitábamos para crear el <code>SwapChain</code>. Una vez que tenemos un <code>Device</code>, tenemos todo lo que necesitamos para comenzar a enviar comandos a la gpu.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> adapter <span class="token operator">=</span> instance
    <span class="token punctuation">.</span><span class="token function">request_adapter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RequestAdapterOptions</span> <span class="token punctuation">{</span>
        power_preference<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PowerPreference</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        compatible_surface<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>device<span class="token punctuation">,</span> queue<span class="token punctuation">)</span> <span class="token operator">=</span> adapter
    <span class="token punctuation">.</span><span class="token function">request_device</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="un-triangulo-sin-ventana"><a href="#un-triangulo-sin-ventana" class="header-anchor">#</a> Un triángulo sin ventana</h2> <p>Ahora hemos hablado sobre no necesitar ver qué está haciendo la gpu, pero necesitamos ver los resultados en algún momento. Si miramos atrás la discusión sobre la <a href="/learn-wgpu-es/beginner/tutorial2-surface/#render">surface</a> vemos que usamos <code>surface.get_current_texture()</code> para obtener una textura para dibujar. Saltaremos ese paso creando la textura nosotros mismos. Una cosa a tener en cuenta aquí es que necesitamos especificar <code>wgpu::TextureFormat::Rgba8UnormSrgb</code> al <code>format</code> en lugar de <code>surface.get_preferred_format(&amp;adapter)</code> ya que PNG usa RGBA, no BGRA.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> texture_size <span class="token operator">=</span> <span class="token number">256u32</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> texture_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDescriptor</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Extent3d</span> <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> texture_size<span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> texture_size<span class="token punctuation">,</span>
        depth_or_array_layers<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mip_level_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    sample_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    dimension<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDimension</span><span class="token punctuation">::</span><span class="token constant">D2</span><span class="token punctuation">,</span>
    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8UnormSrgb</span><span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_SRC</span>
        <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">RENDER_ATTACHMENT</span>
        <span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> texture <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>texture_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> texture_view <span class="token operator">=</span> texture<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Estamos usando <code>TextureUsages::RENDER_ATTACHMENT</code> para que wgpu pueda renderizar a nuestra textura. El <code>TextureUsages::COPY_SRC</code> es para que podamos extraer datos de la textura para poder guardarla en un archivo.</p> <p>Aunque podemos usar esta textura para dibujar nuestro triángulo, necesitamos alguna forma de acceder a los píxeles dentro de ella. En el <a href="/learn-wgpu-es/beginner/tutorial5-textures/">tutorial de texturas</a> usamos un búfer para cargar datos de color desde un archivo que luego copiamos en nuestro búfer. Ahora vamos a hacer lo inverso: copiar datos a un búfer desde nuestra textura para guardar en un archivo. Necesitaremos un búfer lo suficientemente grande para nuestros datos.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// we need to store this for later</span>
<span class="token keyword">let</span> u32_size <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> output_buffer_size <span class="token operator">=</span> <span class="token punctuation">(</span>u32_size <span class="token operator">*</span> texture_size <span class="token operator">*</span> texture_size<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> output_buffer_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferDescriptor</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> output_buffer_size<span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span>
        <span class="token comment">// this tells wpgu that we want to read this buffer from the cpu</span>
        <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">MAP_READ</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    mapped_at_creation<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> output_buffer <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>output_buffer_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ahora que tenemos algo en lo que dibujar, hagamos algo para dibujar. Como solo estamos dibujando un triángulo, tomemos el código del shader del <a href="/learn-wgpu-es/beginner/tutorial3-pipeline/#writing-the-shaders">tutorial de pipeline</a>.</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">// shader.vert</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">450</span></span></span>

<span class="token keyword">const</span> <span class="token keyword">vec2</span> positions<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>positions<span class="token punctuation">[</span>gl_VertexIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">// shader.frag</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">450</span></span></span>

<span class="token keyword">layout</span><span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">out</span> <span class="token keyword">vec4</span> f_color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Actualiza las dependencias para soportar módulos SPIR-V.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.23&quot;</span>
<span class="token key property">shaderc</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.7&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;27.0.0&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;spirv&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">pollster</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3&quot;</span>
</code></pre></div><p>Usando eso crearemos un simple <code>RenderPipeline</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> vs_src <span class="token operator">=</span> <span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.vert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_src <span class="token operator">=</span> <span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.frag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> compiler <span class="token operator">=</span> <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">Compiler</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_spirv <span class="token operator">=</span> compiler
    <span class="token punctuation">.</span><span class="token function">compile_into_spirv</span><span class="token punctuation">(</span>
        vs_src<span class="token punctuation">,</span>
        <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">ShaderKind</span><span class="token punctuation">::</span><span class="token class-name">Vertex</span><span class="token punctuation">,</span>
        <span class="token string">&quot;shader.vert&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_spirv <span class="token operator">=</span> compiler
    <span class="token punctuation">.</span><span class="token function">compile_into_spirv</span><span class="token punctuation">(</span>
        fs_src<span class="token punctuation">,</span>
        <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">ShaderKind</span><span class="token punctuation">::</span><span class="token class-name">Fragment</span><span class="token punctuation">,</span>
        <span class="token string">&quot;shader.frag&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_data <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token function">make_spirv</span><span class="token punctuation">(</span>vs_spirv<span class="token punctuation">.</span><span class="token function">as_binary_u8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_data <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token function">make_spirv</span><span class="token punctuation">(</span>fs_spirv<span class="token punctuation">.</span><span class="token function">as_binary_u8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_module <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Vertex Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source<span class="token punctuation">:</span> vs_data<span class="token punctuation">,</span>
    flags<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderFlags</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_module <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Fragment Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source<span class="token punctuation">:</span> fs_data<span class="token punctuation">,</span>
    flags<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderFlags</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> render_pipeline_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline Layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    push_constant_ranges<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> render_pipeline <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_render_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipelineDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    layout<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pipeline_layout<span class="token punctuation">)</span><span class="token punctuation">,</span>
    vertex<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexState</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>vs_module<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        buffers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    fragment<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FragmentState</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>fs_module<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        targets<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorTargetState</span> <span class="token punctuation">{</span>
            format<span class="token punctuation">:</span> texture_desc<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
            alpha_blend<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendState</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">,</span>
            color_blend<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendState</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">,</span>
            write_mask<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorWrites</span><span class="token punctuation">::</span><span class="token constant">ALL</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    primitive<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveState</span> <span class="token punctuation">{</span>
        topology<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveTopology</span><span class="token punctuation">::</span><span class="token class-name">TriangleList</span><span class="token punctuation">,</span>
        strip_index_format<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        front_face<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FrontFace</span><span class="token punctuation">::</span><span class="token class-name">Ccw</span><span class="token punctuation">,</span>
        cull_mode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Face</span><span class="token punctuation">::</span><span class="token class-name">Back</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// Setting this to anything other than Fill requires Features::NON_FILL_POLYGON_MODE</span>
        polygon_mode<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PolygonMode</span><span class="token punctuation">::</span><span class="token class-name">Fill</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    depth_stencil<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    multisample<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MultisampleState</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        mask<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
        alpha_to_coverage_enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vamos a necesitar un encoder, así que hagámoslo.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">CommandEncoderDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El <code>RenderPass</code> es donde las cosas se ponen interesantes. Un render pass requiere al menos un color attachment. Un color attachment requiere un <code>TextureView</code> para adjuntar. Solíamos usar una textura del <code>SwapChain</code> para esto, pero cualquier <code>TextureView</code> funcionará, incluida nuestra <code>texture_view</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> render_pass_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassColorAttachment</span> <span class="token punctuation">{</span>
                view<span class="token punctuation">:</span> <span class="token operator">&amp;</span>texture_view<span class="token punctuation">,</span>
                resolve_target<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                ops<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Operations</span> <span class="token punctuation">{</span>
                    load<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">LoadOp</span><span class="token punctuation">::</span><span class="token class-name">Clear</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Color</span> <span class="token punctuation">{</span>
                        r<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                        g<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
                        b<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
                        a<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    store<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StoreOp</span><span class="token punctuation">::</span><span class="token class-name">Store</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        depth_stencil_attachment<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> render_pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_render_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pass_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
    render_pass<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>No hay mucho que podamos hacer con los datos cuando están atrapados en una <code>Texture</code>, así que copiémoslos en nuestro <code>output_buffer</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_buffer</span><span class="token punctuation">(</span>
    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
        aspect<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureAspect</span><span class="token punctuation">::</span><span class="token class-name">All</span><span class="token punctuation">,</span>
                texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span>texture<span class="token punctuation">,</span>
        mip_level<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        origin<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Origin3d</span><span class="token punctuation">::</span><span class="token constant">ZERO</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyBufferInfo</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">:</span> <span class="token operator">&amp;</span>output_buffer<span class="token punctuation">,</span>
        layout<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyBufferLayout</span> <span class="token punctuation">{</span>
            offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            bytes_per_row<span class="token punctuation">:</span> u32_size <span class="token operator">*</span> texture_size<span class="token punctuation">,</span>
            rows_per_image<span class="token punctuation">:</span> texture_size<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    texture_desc<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ahora que hemos hecho todos nuestros comandos, enviémoslos a la gpu.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>queue<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="extrayendo-datos-de-un-bufer"><a href="#extrayendo-datos-de-un-bufer" class="header-anchor">#</a> Extrayendo datos de un búfer</h2> <p>Para obtener los datos fuera del búfer, primero necesitamos mapearlo, entonces podemos obtener una <code>BufferView</code> que podemos tratar como <code>&amp;[u8]</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// We need to scope the mapping variables so that we can</span>
<span class="token comment">// unmap the buffer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> buffer_slice <span class="token operator">=</span> output_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// NOTE: We have to create the mapping THEN device.poll() before await</span>
    <span class="token comment">// the future. Otherwise the application will freeze.</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">futures_intrusive<span class="token punctuation">::</span>channel<span class="token punctuation">::</span>shared<span class="token punctuation">::</span></span><span class="token function">oneshot_channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer_slice<span class="token punctuation">.</span><span class="token function">map_async</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MapMode</span><span class="token punctuation">::</span><span class="token class-name">Read</span><span class="token punctuation">,</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>result<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    device<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PollType</span><span class="token punctuation">::</span><span class="token function">wait_indefinitely</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    rx<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> data <span class="token operator">=</span> buffer_slice<span class="token punctuation">.</span><span class="token function">get_mapped_range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">use</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">ImageBuffer</span><span class="token punctuation">,</span> <span class="token class-name">Rgba</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> buffer <span class="token operator">=</span>
        <span class="token class-name">ImageBuffer</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Rgba</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> _<span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from_raw</span><span class="token punctuation">(</span>texture_size<span class="token punctuation">,</span> texture_size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;image.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
output_buffer<span class="token punctuation">.</span><span class="token function">unmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="note"><p>Usé <a href="https://docs.rs/futures-intrusive" target="_blank" rel="noopener noreferrer">futures-intrusive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ya que es el crate que usan en los <a href="https://github.com/gfx-rs/wgpu/tree/master/wgpu/examples/capture" target="_blank" rel="noopener noreferrer">ejemplos en el repositorio de wgpu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h2 id="main-no-es-asincronico"><a href="#main-no-es-asincronico" class="header-anchor">#</a> Main no es asincrónico</h2> <p>El método <code>main()</code> no puede retornar un future, así que no podemos usar la palabra clave <code>async</code>. Lo solucionaremos poniendo nuestro código en una función diferente para que podamos bloquearlo en <code>main()</code>. Necesitarás usar un crate que pueda sondear futures como el <a href="https://docs.rs/pollster" target="_blank" rel="noopener noreferrer">crate pollster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="note"><p>Hay crates como <a href="https://docs.rs/async-std" target="_blank" rel="noopener noreferrer">async-std<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y <a href="https://docs.rs/tokio" target="_blank" rel="noopener noreferrer">tokio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> que puedes usar para anotar <code>main()</code> para que sea asincrónico. Opté por no hacerlo ya que ambos crates son un poco más pesados para este proyecto. Eres bienvenido a usar cualquier configuración asincrónica que prefieras 🙂</p></div> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Windowless drawing code...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Con todo eso, deberías tener una imagen como esta.</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAFq0lEQVR4nO3U2XVcRxBEQcovOiJf5IY8kl8SRLAPAXAweEvvGfFRFlTeP/786+9/vwGRBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEINj3b/+83G8v9/vLJZEABBMABCBUGX8hApkEIJQA8D8BCPRx/IUI5BGAQAJAIQBhPht/IQJZBCCMAPCWAAT5avyFCOQQgCACwEcCEOLo+AsRyCAAIQSARwQgwNnxFyKwPwEIIAB8RgA2d3X8hQjsTQA2JwA8IwAbuzv+QgT2JQAbEwC+IgCbqjX+QgT2JACbEgCOEIAN1R5/IQL7EYANCQBHCcBmWo2/EIG9CMBmBIAzBGAjrcdfiMA+BGAjAsBZArCJXuMvRGAPArAJAeAKAdhA7/EXIrA+AdiAAHCVACxu1PgLEVibACxOALhDABY2evyFCKxLABYmANwlAIuaZfyFCKxJABYlANQgAAuabfyFCKxHABYkANQiAIuZdfyFCKxFABYjANQkAAuZffyFCKxDABYiANQmAItYZfyFCKxBABYhALQgAAtYbfyFCMxPABYgALQiAJNbdfyFCMxNACYnALQkABNbffyFCMxLACYmALQmAJPaZfyFCMxJACYlAPQgABPabfyFCMxHACYkAPQiAJPZdfyFCMxFACYjAPQkABPZffyFCMxDACYiAPQmAJNIGX8hAnMQgEkIACMIwATSxl+IwHgCMAEBYBQBGCx1/IUIjCUAgwmAAIwkAAOlj78QgXEEYCABeCUA4wjAIMb/ngiMIQCDCMB7AjCGAAxg/I+JQH8CMIAAPCYA/QlAZ8b/nAj0JQCdCcBzAtCXAHRk/MeIQD8C0JEAHCMA/QhAJ8Z/jgj0IQCdCMA5AtCHAHRg/NeIQHsC0IEAXCMA7QlAY8Z/jwi0JQCNCcA9AtCWADRk/HWIQDsC0JAA1CEA7QhAI8Zflwi0IQCNCEBdAtCGADRg/G2IQH0C0IAAtCEA9QlAZcbflgjUJQCVCUBbAlCXAFRk/H2IQD0CUJEA9CEA9QhAJcbflwjUIQCVCEBfAlCHAFRg/GOIwH0CUIEAjCEA9wnATcY/lgjcIwA3CcBYAnCPANxg/HMQgesE4AYBmIMAXCcAFxn/XETgGgG4SADmIgDXCMAFxj8nEThPAC4QgDkJwHkCcJLxz00EzhGAkwRgbgJwjgCcYPxrEIHjBOAEAViDABwnAAcZ/1pE4BgBOEgA1iIAxwjAAca/JhH4mgAcIABrEoCvCcAXjH9tIvCcAHxBANYmAM8JwBPGvwcR+JwAPCEAexCAzwnAJ4x/LyLwmAB8QgD2IgCPCcADxr8nEfidADwgAHsSgN8JwAfGvzcReE8APhCAvQnAewLwhvFnEIFfBOANAcggAL8IwE/Gn0UEXgnATwKQRQBeCcAL488kAgLwgwBkEgABeHkB40+WHoH4AEAyAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAINh/p/JoLhfYRNsAAAAASUVORK5CYII=" alt="a brown triangle"></p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/showcase/windowless/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Última Actualización: </span> <span class="time">12/15/2025, 10:51:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-es/showcase/" class="prev router-link-active">
          Prólogo
        </a></span> <span class="next"><a href="/learn-wgpu-es/showcase/gifs/">
          Creando GIFs
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-es/assets/js/app.1da4b688.js" defer></script><script src="/learn-wgpu-es/assets/js/3.adbf9188.js" defer></script><script src="/learn-wgpu-es/assets/js/2.cb1a7929.js" defer></script><script src="/learn-wgpu-es/assets/js/54.e3d2968f.js" defer></script><script src="/learn-wgpu-es/assets/js/38.875f4ce4.js" defer></script>
  </body>
</html>
