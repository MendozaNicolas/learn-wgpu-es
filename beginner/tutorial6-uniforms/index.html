<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Búferes uniformes y una cámara 3D | Learn Wgpu - Español</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css" as="style"><link rel="preload" href="/learn-wgpu-es/assets/js/app.fb31abca.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/2.1022e2be.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/1.4766453e.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/32.b00abf9b.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/23.247ad87d.js" as="script"><link rel="preload" href="/learn-wgpu-es/assets/js/22.5d980ee9.js" as="script"><link rel="prefetch" href="/learn-wgpu-es/assets/js/10.85d1b333.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/11.3c198606.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/12.97c631a2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/13.8eb85f08.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/14.f56f5783.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/15.f146080a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/16.b78eff55.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/17.ac1b915c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/18.d64e2c10.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/19.b80b7231.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/20.5525796a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/21.d2868a6a.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/24.086d80a7.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/25.0ba438e3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/26.aed3aec3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/27.b4a1c2ae.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/28.2764cb5c.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/29.58f67d16.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/3.210ed7b2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/30.c5e766e5.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/31.5a6c1c03.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/33.c2bc481b.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/34.f2bc04d8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/35.58c2c8d8.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/36.d4783bfb.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/37.0f259387.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/38.3c99ab64.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/39.84e651b2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/4.db40dd96.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/40.56d1e232.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/41.f90ff503.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/42.7911692d.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/43.4f83f7e5.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/44.943c009e.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/45.0ab6ac73.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/46.c4185287.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/47.777cc2bf.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/48.96be8e13.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/49.aa04b1d6.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/5.6fdb9071.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/50.4022d2a0.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/51.3c411e45.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/52.2918a592.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/53.ee6c7c86.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/54.ec95ed52.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/55.da436f39.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/56.a7464507.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/57.38978bd1.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/58.f03403ea.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/59.d0f0d3af.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/60.675b3161.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/61.0d9a5510.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/62.cb765cf3.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/8.c8ddf2a2.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/9.28f40848.js"><link rel="prefetch" href="/learn-wgpu-es/assets/js/vendors~docsearch.ccaccf87.js">
    <link rel="stylesheet" href="/learn-wgpu-es/assets/css/0.styles.54a9523f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-es/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu - Español</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-es/" aria-current="page" class="sidebar-link">Introducción</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Principiante</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/beginner/tutorial1-window/" class="sidebar-link">Dependencias y la ventana</a></li><li><a href="/learn-wgpu-es/beginner/tutorial2-surface/" class="sidebar-link">La Superficie</a></li><li><a href="/learn-wgpu-es/beginner/tutorial3-pipeline/" class="sidebar-link">El Pipeline</a></li><li><a href="/learn-wgpu-es/beginner/tutorial4-buffer/" class="sidebar-link">Búferes e Índices</a></li><li><a href="/learn-wgpu-es/beginner/tutorial5-textures/" class="sidebar-link">Texturas y grupos de enlace</a></li><li><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/" aria-current="page" class="active sidebar-link">Búferes uniformes y una cámara 3D</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#una-camara-de-perspectiva" class="sidebar-link">Una cámara de perspectiva</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#el-bufer-uniforme" class="sidebar-link">El búfer uniforme</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#buferes-uniformes-y-grupos-de-enlace" class="sidebar-link">Búferes uniformes y grupos de enlace</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#usando-el-uniforme-en-el-vertex-shader" class="sidebar-link">Usando el uniforme en el vertex shader</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#un-controlador-para-nuestra-camara" class="sidebar-link">Un controlador para nuestra cámara</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#demo" class="sidebar-link">Demo</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-es/beginner/tutorial6-uniforms/#desafio" class="sidebar-link">Desafío</a></li></ul></li><li><a href="/learn-wgpu-es/beginner/tutorial7-instancing/" class="sidebar-link">Instanciación</a></li><li><a href="/learn-wgpu-es/beginner/tutorial8-depth/" class="sidebar-link">El Búfer de Profundidad</a></li><li><a href="/learn-wgpu-es/beginner/tutorial9-models/" class="sidebar-link">Carga de Modelos</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermedio</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-es/intermediate/tutorial10-lighting/" class="sidebar-link">Trabajando con Luces</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial11-normals/" class="sidebar-link">Mapeo de Normales</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial12-camera/" class="sidebar-link">Una Cámara Mejor</a></li><li><a href="/learn-wgpu-es/intermediate/tutorial13-hdr/" class="sidebar-link">Renderizado de Alto Rango Dinámico</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Compute Pipelines</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Showcase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Noticias</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="buferes-uniformes-y-una-camara-3d"><a href="#buferes-uniformes-y-una-camara-3d" class="header-anchor">#</a> Búferes uniformes y una cámara 3D</h1> <p>Aunque todo nuestro trabajo anterior parecía estar en 2D, en realidad hemos estado trabajando en 3D todo el tiempo! Por eso nuestra estructura <code>Vertex</code> tiene <code>position</code> como un array de 3 floats en lugar de solo 2. No podemos realmente ver la naturaleza 3D de nuestra escena porque estamos viendo las cosas de frente. Vamos a cambiar nuestro punto de vista creando una <code>Camera</code>.</p> <h2 id="una-camara-de-perspectiva"><a href="#una-camara-de-perspectiva" class="header-anchor">#</a> Una cámara de perspectiva</h2> <p>Este tutorial es más sobre aprender a usar wgpu que sobre álgebra lineal, así que voy a pasar por alto mucha de la matemática involucrada. Hay mucho material de lectura en línea si estás interesado en lo que sucede bajo el capó. Vamos a usar <a href="https://docs.rs/cgmath" target="_blank" rel="noopener noreferrer">cgmath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para manejar toda la matemática por nosotros. Añade lo siguiente a tu <code>Cargo.toml</code>.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token comment"># other deps...</span>
<span class="token key property">cgmath</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.18&quot;</span>
</code></pre></div><p>Ahora que tenemos una biblioteca de matemática, ¡usémosla! Crea una estructura <code>Camera</code> arriba de la estructura <code>State</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Camera</span> <span class="token punctuation">{</span>
    eye<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Point3</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    target<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Point3</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    up<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector3</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    aspect<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
    fovy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
    znear<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
    zfar<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Camera</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">build_view_projection_matrix</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.</span>
        <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">look_at_rh</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>eye<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.</span>
        <span class="token keyword">let</span> proj <span class="token operator">=</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token function">perspective</span><span class="token punctuation">(</span><span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Deg</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>fovy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>aspect<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>znear<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>zfar<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.</span>
        <span class="token keyword">return</span> <span class="token constant">OPENGL_TO_WGPU_MATRIX</span> <span class="token operator">*</span> proj <span class="token operator">*</span> view<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>El <code>build_view_projection_matrix</code> es donde ocurre la magia.</p> <ol><li>La matriz <code>view</code> mueve el mundo para que esté en la posición y rotación de la cámara. Es esencialmente una inversa de lo que sería la matriz de transformación de la cámara.</li> <li>La matriz <code>proj</code> distorsiona la escena para dar el efecto de profundidad. Sin esto, los objetos cerca serían del mismo tamaño que los objetos lejanos.</li> <li>El sistema de coordenadas en Wgpu se basa en los sistemas de coordenadas de DirectX y Metal. Eso significa que en <a href="https://github.com/gfx-rs/gfx/tree/master/src/backend/dx12#normalized-coordinates" target="_blank" rel="noopener noreferrer">coordenadas de dispositivo normalizadas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, el eje x y el eje y están en el rango de -1.0 a +1.0, y el eje z es de 0.0 a +1.0. El crate <code>cgmath</code> (así como la mayoría de los crates de matemática de juegos) está construido para el sistema de coordenadas de OpenGL. Esta matriz escalará y trasladará nuestra escena del sistema de coordenadas de OpenGL al de WGPU. Lo definiremos como sigue.</li></ol> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[rustfmt::skip]</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">OPENGL_TO_WGPU_MATRIX</span><span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">from_cols</span><span class="token punctuation">(</span>
    <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector4</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector4</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector4</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector4</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Nota: No necesitamos explícitamente la <code>OPENGL_TO_WGPU_MATRIX</code>, pero los modelos centrados en (0, 0, 0) estarán a mitad de camino dentro del área de recorte. Esto solo es un problema si no estás usando una matriz de cámara.</li></ul> <p>Ahora vamos a añadir un campo <code>camera</code> a <code>State</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    camera<span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token class-name">Window</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token comment">// let diffuse_bind_group ...</span>

    <span class="token keyword">let</span> camera <span class="token operator">=</span> <span class="token class-name">Camera</span> <span class="token punctuation">{</span>
        <span class="token comment">// posiciona la cámara 1 unidad hacia arriba y 2 unidades hacia atrás</span>
        <span class="token comment">// +z está fuera de la pantalla</span>
        eye<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// haz que mire al origen</span>
        target<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// cuál es la dirección &quot;arriba&quot;</span>
        up<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector3</span><span class="token punctuation">::</span><span class="token function">unit_y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        aspect<span class="token punctuation">:</span> config<span class="token punctuation">.</span>width <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">/</span> config<span class="token punctuation">.</span>height <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
        fovy<span class="token punctuation">:</span> <span class="token number">45.0</span><span class="token punctuation">,</span>
        znear<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
        zfar<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        camera<span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Ahora que tenemos nuestra cámara, y puede crear una matriz de proyección de vista, necesitamos un lugar para ponerla. También necesitamos una forma de introducirla en nuestros shaders.</p> <h2 id="el-bufer-uniforme"><a href="#el-bufer-uniforme" class="header-anchor">#</a> El búfer uniforme</h2> <p>Hasta este punto, hemos usado <code>Buffer</code>s para almacenar nuestros datos de vértices e índices, e incluso para cargar nuestras texturas. Vamos a usarlos de nuevo para crear lo que se conoce como un búfer uniforme. Un uniforme es un blob de datos disponible para cada invocación de un conjunto de shaders. Técnicamente, ya hemos usado uniformes para nuestra textura y sampler. Vamos a usarlos de nuevo para almacenar nuestra matriz de proyección de vista. Para empezar, vamos a crear una estructura para mantener nuestro uniforme.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// Necesitamos esto para que Rust almacene nuestros datos correctamente para los shaders</span>
<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token comment">// Esto es para que podamos almacenar esto en un búfer</span>
<span class="token attribute attr-name">#[derive(Debug, Copy, Clone, bytemuck::Pod, bytemuck::Zeroable)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">CameraUniform</span> <span class="token punctuation">{</span>
    <span class="token comment">// No podemos usar cgmath con bytemuck directamente, así que tendremos</span>
    <span class="token comment">// que convertir la Matrix4 en un array f32 de 4x4</span>
    view_proj<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">CameraUniform</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">use</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">SquareMatrix</span><span class="token punctuation">;</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            view_proj<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">update_view_proj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> camera<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Camera</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view_proj <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">build_view_projection_matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Ahora que tenemos nuestros datos estructurados, vamos a hacer nuestro <code>camera_buffer</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// en new() después de crear `camera`</span>

<span class="token keyword">let</span> <span class="token keyword">mut</span> camera_uniform <span class="token operator">=</span> <span class="token class-name">CameraUniform</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera_uniform<span class="token punctuation">.</span><span class="token function">update_view_proj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> camera_buffer <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_buffer_init</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token class-name">BufferInitDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Camera Buffer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contents<span class="token punctuation">:</span> <span class="token namespace">bytemuck<span class="token punctuation">::</span></span><span class="token function">cast_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>camera_uniform<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">UNIFORM</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="buferes-uniformes-y-grupos-de-enlace"><a href="#buferes-uniformes-y-grupos-de-enlace" class="header-anchor">#</a> Búferes uniformes y grupos de enlace</h2> <p>¡Bien! Ahora que tenemos un búfer uniforme, ¿qué hacemos con él? La respuesta es que creamos un grupo de enlace para él. Primero, tenemos que crear el diseño del grupo de enlace.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> camera_bind_group_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutDescriptor</span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutEntry</span> <span class="token punctuation">{</span>
            binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            visibility<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">VERTEX</span><span class="token punctuation">,</span>
            ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingType</span><span class="token punctuation">::</span><span class="token class-name">Buffer</span> <span class="token punctuation">{</span>
                ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferBindingType</span><span class="token punctuation">::</span><span class="token class-name">Uniform</span><span class="token punctuation">,</span>
                has_dynamic_offset<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                min_binding_size<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            count<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;camera_bind_group_layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Algunas cosas a tener en cuenta:</p> <ol><li>Configuramos <code>visibility</code> a <code>ShaderStages::VERTEX</code> porque realmente solo necesitamos información de cámara en el vertex shader,
ya que es lo que usaremos para manipular nuestros vértices.</li> <li><code>has_dynamic_offset</code> significa que la ubicación de los datos en el búfer puede cambiar. Este será el caso si
almacenas múltiples conjuntos de datos de tamaño variable en un único búfer. Si lo estableces en true, tendrás que
suministrar los desplazamientos más tarde.</li> <li><code>min_binding_size</code> especifica el tamaño más pequeño que puede tener el búfer. No tienes que especificar esto, así que
lo dejamos como <code>None</code>. Si quieres saber más, puedes revisar <a href="https://docs.rs/wgpu/latest/wgpu/enum.BindingType.html#variant.Buffer.field.min_binding_size" target="_blank" rel="noopener noreferrer">la documentación<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ol> <p>Ahora, podemos crear el grupo de enlace real.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> camera_bind_group <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupDescriptor</span> <span class="token punctuation">{</span>
    layout<span class="token punctuation">:</span> <span class="token operator">&amp;</span>camera_bind_group_layout<span class="token punctuation">,</span>
    entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
            binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            resource<span class="token punctuation">:</span> camera_buffer<span class="token punctuation">.</span><span class="token function">as_entire_binding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;camera_bind_group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Como con nuestra textura, necesitamos registrar nuestro <code>camera_bind_group_layout</code> con el pipeline de renderizado.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> render_pipeline_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline Layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token operator">&amp;</span>texture_bind_group_layout<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span>camera_bind_group_layout<span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        push_constant_ranges<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ahora necesitamos añadir <code>camera_buffer</code> y <code>camera_bind_group</code> a <code>State</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    camera<span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">,</span>
    camera_uniform<span class="token punctuation">:</span> <span class="token class-name">CameraUniform</span><span class="token punctuation">,</span>
    camera_buffer<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Buffer</span><span class="token punctuation">,</span>
    camera_bind_group<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token class-name">Window</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        camera<span class="token punctuation">,</span>
        camera_uniform<span class="token punctuation">,</span>
        camera_buffer<span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La última cosa que necesitamos hacer antes de entrar en shaders es usar el grupo de enlace en <code>render()</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
render_pass<span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>diffuse_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ¡NUEVO!</span>
render_pass<span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
render_pass<span class="token punctuation">.</span><span class="token function">set_vertex_buffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>vertex_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
render_pass<span class="token punctuation">.</span><span class="token function">set_index_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>index_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">IndexFormat</span><span class="token punctuation">::</span><span class="token class-name">Uint16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

render_pass<span class="token punctuation">.</span><span class="token function">draw_indexed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token keyword">self</span><span class="token punctuation">.</span>num_indices<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="usando-el-uniforme-en-el-vertex-shader"><a href="#usando-el-uniforme-en-el-vertex-shader" class="header-anchor">#</a> Usando el uniforme en el vertex shader</h2> <p>Modifica el vertex shader para incluir lo siguiente.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token comment">// Vertex shader</span>
<span class="token keyword">struct</span> <span class="token class-name">CameraUniform</span> <span class="token punctuation">{</span>
    view_proj<span class="token punctuation">:</span> <span class="token builtin">mat4x4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token comment">// 1.</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> camera<span class="token punctuation">:</span> <span class="token class-name">CameraUniform</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexInput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> tex_coords<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> clip_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> tex_coords<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span>
<span class="token keyword">fn</span> <span class="token functions function">vs_main</span><span class="token punctuation">(</span>
    model<span class="token punctuation">:</span> <span class="token class-name">VertexInput</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> out<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>tex_coords <span class="token operator">=</span> model<span class="token punctuation">.</span>tex_coords<span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>clip_position <span class="token operator">=</span> camera<span class="token punctuation">.</span>view_proj <span class="token operator">*</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2.</span>
    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>Porque hemos creado un nuevo grupo de enlace, necesitamos especificar cuál estamos usando en el shader. El número está determinado por nuestro <code>render_pipeline_layout</code>. El <code>texture_bind_group_layout</code> se enumera primero, por lo que es <code>group(0)</code>, y <code>camera_bind_group</code> es el segundo, así que es <code>group(1)</code>.</li> <li>El orden de multiplicación es importante cuando se trata de matrices. El vector va a la derecha, y las matrices van a la izquierda en orden de importancia.</li></ol> <h2 id="un-controlador-para-nuestra-camara"><a href="#un-controlador-para-nuestra-camara" class="header-anchor">#</a> Un controlador para nuestra cámara</h2> <p>Si ejecutas el código ahora mismo, deberías obtener algo como esto.</p> <p><img src="/learn-wgpu-es/assets/img/static-tree.17986854.png" alt="./static-tree.png"></p> <p>La forma ahora está menos estirada, pero sigue siendo bastante estática. Puedes experimentar moviendo la posición de la cámara, pero la mayoría de las cámaras en los juegos se mueven. Como este tutorial es sobre usar wgpu y no sobre cómo procesar la entrada del usuario, simplemente voy a publicar el código de <code>CameraController</code> a continuación.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">CameraController</span> <span class="token punctuation">{</span>
    speed<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
    is_forward_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    is_backward_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    is_left_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    is_right_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">CameraController</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>speed<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            speed<span class="token punctuation">,</span>
            is_forward_pressed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            is_backward_pressed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            is_left_pressed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            is_right_pressed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">handle_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token class-name">KeyCode</span><span class="token punctuation">,</span> is_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> code <span class="token punctuation">{</span>
            <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">KeyW</span> <span class="token operator">|</span> <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">ArrowUp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>is_forward_pressed <span class="token operator">=</span> is_pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">KeyA</span> <span class="token operator">|</span> <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">ArrowLeft</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>is_left_pressed <span class="token operator">=</span> is_pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">KeyS</span> <span class="token operator">|</span> <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">ArrowDown</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>is_backward_pressed <span class="token operator">=</span> is_pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">KeyD</span> <span class="token operator">|</span> <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">ArrowRight</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>is_right_pressed <span class="token operator">=</span> is_pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">update_camera</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> camera<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Camera</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">use</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">InnerSpace</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> forward <span class="token operator">=</span> camera<span class="token punctuation">.</span>target <span class="token operator">-</span> camera<span class="token punctuation">.</span>eye<span class="token punctuation">;</span>
        <span class="token keyword">let</span> forward_norm <span class="token operator">=</span> forward<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> forward_mag <span class="token operator">=</span> forward<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Previene parpadeos cuando la cámara se acerca demasiado al</span>
        <span class="token comment">// centro de la escena.</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>is_forward_pressed <span class="token operator">&amp;&amp;</span> forward_mag <span class="token operator">&gt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>speed <span class="token punctuation">{</span>
            camera<span class="token punctuation">.</span>eye <span class="token operator">+=</span> forward_norm <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>speed<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>is_backward_pressed <span class="token punctuation">{</span>
            camera<span class="token punctuation">.</span>eye <span class="token operator">-=</span> forward_norm <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>speed<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> right <span class="token operator">=</span> forward_norm<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Recalcula el radio en caso de que se presione adelante/atrás.</span>
        <span class="token keyword">let</span> forward <span class="token operator">=</span> camera<span class="token punctuation">.</span>target <span class="token operator">-</span> camera<span class="token punctuation">.</span>eye<span class="token punctuation">;</span>
        <span class="token keyword">let</span> forward_mag <span class="token operator">=</span> forward<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>is_right_pressed <span class="token punctuation">{</span>
            <span class="token comment">// Reescala la distancia entre el objetivo y el ojo para que</span>
            <span class="token comment">// no cambie. El ojo, por lo tanto, sigue siendo</span>
            <span class="token comment">// situado en el círculo hecho por el objetivo y el ojo.</span>
            camera<span class="token punctuation">.</span>eye <span class="token operator">=</span> camera<span class="token punctuation">.</span>target <span class="token operator">-</span> <span class="token punctuation">(</span>forward <span class="token operator">+</span> right <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>speed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> forward_mag<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>is_left_pressed <span class="token punctuation">{</span>
            camera<span class="token punctuation">.</span>eye <span class="token operator">=</span> camera<span class="token punctuation">.</span>target <span class="token operator">-</span> <span class="token punctuation">(</span>forward <span class="token operator">-</span> right <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>speed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> forward_mag<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Este código no es perfecto. La cámara se mueve lentamente hacia atrás cuando la rotas. Funciona para nuestros propósitos, sin embargo. ¡Siéntete libre de mejorarlo!</p> <p>Todavía necesitamos conectar esto a nuestro código existente para que haga algo. Añade el controlador a <code>State</code> y créalo en <code>new()</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    camera<span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">,</span>
    <span class="token comment">// NEW!</span>
    camera_controller<span class="token punctuation">:</span> <span class="token class-name">CameraController</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">impl</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Window</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">let</span> camera_controller <span class="token operator">=</span> <span class="token class-name">CameraController</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>

        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            camera_controller<span class="token punctuation">,</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Actualizaremos el <code>camera_controller</code> en la función <code>handle_key</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token keyword">fn</span> <span class="token function-definition function">handle_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> event_loop<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">ActiveEventLoop</span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token class-name">KeyCode</span><span class="token punctuation">,</span> is_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">Escape</span> <span class="token operator">&amp;&amp;</span> is_pressed <span class="token punctuation">{</span>
            event_loop<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>camera_controller<span class="token punctuation">.</span><span class="token function">handle_key</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> is_pressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Hasta este punto, el controlador de cámara no está haciendo nada. Los valores en nuestro búfer uniforme necesitan ser actualizados. Hay algunos métodos principales para hacer eso.</p> <ol><li>Podemos crear un búfer separado y copiar su contenido a nuestro <code>camera_buffer</code>. El nuevo búfer se conoce como un búfer de preparación. Este método es generalmente cómo se hace, ya que permite que el contenido del búfer principal (en este caso, <code>camera_buffer</code>) sea accesible solo por la GPU. La GPU puede hacer algunas optimizaciones de velocidad, que no podría si pudiéramos acceder al búfer a través de la CPU.</li> <li>Podemos llamar a uno de los métodos de mapeo <code>map_read_async</code> y <code>map_write_async</code> en el búfer mismo. Estos nos permiten acceder directamente al contenido de un búfer pero requieren que tratemos con el aspecto <code>async</code> de estos métodos. Esto también requiere que nuestro búfer use <code>BufferUsages::MAP_READ</code> y/o <code>BufferUsages::MAP_WRITE</code>. No hablaremos de ello aquí, pero consulta el tutorial <a href="../../showcase/windowless">Wgpu sin ventana</a> si quieres saber más.</li> <li>Podemos usar <code>write_buffer</code> en <code>queue</code>.</li></ol> <p>Vamos a usar la opción número 3.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>camera_controller<span class="token punctuation">.</span><span class="token function">update_camera</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>camera_uniform<span class="token punctuation">.</span><span class="token function">update_view_proj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">write_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera_buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token namespace">bytemuck<span class="token punctuation">::</span></span><span class="token function">cast_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera_uniform<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Eso es todo lo que necesitamos hacer. Si ejecutas el código ahora, deberías ver un pentágono con nuestra textura de árbol que puedes rotar alrededor y hacer zoom con las teclas wasd/flechas.</p> <h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <div id="wasm-example"><canvas id="canvas"></canvas> <!----> <!----> <!----> <button>
    Click to start Tutorial6_uniforms!
  </button></div> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial6-uniforms/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <h2 id="desafio"><a href="#desafio" class="header-anchor">#</a> Desafío</h2> <p>Haz que nuestro modelo rote por su cuenta independientemente de la cámara. <em>Pista: necesitarás otra matriz para esto.</em></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Última Actualización: </span> <span class="time">12/15/2025, 10:59:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-es/beginner/tutorial5-textures/" class="prev">
          Texturas y grupos de enlace
        </a></span> <span class="next"><a href="/learn-wgpu-es/beginner/tutorial7-instancing/">
          Instanciación
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-es/assets/js/app.fb31abca.js" defer></script><script src="/learn-wgpu-es/assets/js/2.1022e2be.js" defer></script><script src="/learn-wgpu-es/assets/js/1.4766453e.js" defer></script><script src="/learn-wgpu-es/assets/js/32.b00abf9b.js" defer></script><script src="/learn-wgpu-es/assets/js/23.247ad87d.js" defer></script><script src="/learn-wgpu-es/assets/js/22.5d980ee9.js" defer></script>
  </body>
</html>
